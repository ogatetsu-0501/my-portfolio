# 会計システム移行 自動化ツール

## 概要

会計システム移行に伴い、  
**3か月分・3万件超の仕訳を再登録する必要がある状況**が発生しました。

現場にはシステム担当者が常駐しておらず、  
移行作業の自動化や代替手段についても  
関係部署からは「対応は難しい」と案内されていました。

同様の条件下にあった他拠点では、  
最終的に **複数名での総出による手入力対応**が選択されたと聞いています。

本件では、  
「同じ結果になるのは避けたい」という判断から、  
直属の上司の相談をきっかけに対応を開始しました。

---

## 設計方針

本ツールは、  
**今回の拠点に限らず、他拠点でもそのまま使えること**を前提に設計しました。

- CSVの形式や文字コードが拠点ごとに異なる
- データ量が増えても処理が破綻しない
- エンジニアがいない現場でも運用できる

ただし、  
本ツール自体は「1回動けば役目を終える」性質のものであり、  
**開発者である自分が立ち会えない場所・時間帯で実行されるリスク**を強く意識しています。

そのため、  
途中停止・再実行・想定外入力・環境差異が発生しても  
誤登録や二重登録につながらないことを重視した実装としました。

---

## 取り組み方

最初に経理担当者へヒアリングを行い、

- 実際の画面操作手順
- 伝票単位での登録ルール
- 入力ミスが起きやすい箇所
- 作業を止められない時間帯や運用上の制約

を整理しました。

公式なインポート手段が使えない前提で話が進んでいたため、  
**CSVの内容を解析し、人が行っている画面操作をそのまま再現する**  
という方針で実装を開始しました。

---

## 実装途中での判断

開発途中で、  
条件付きではあるものの **CSVインポートに近い手段が存在する可能性**に気づきました。

ただし、

- これまでの判断を覆すための調整コスト
- 大量データを本番環境で検証する手間とリスク
- すでに自動入力ツールが実用段階まで到達していたこと

を考慮し、  
**完成していた自動入力方式をそのまま実行する**判断をしました。

結果として、  
追加検証による遅延を避け、移行作業を完了できました。

---

## 実装の要点（実装内容ベース）

### 1. CSVを「そのまま使える状態」にする処理

CSVは、

- UTF-8 / Shift-JIS 系の文字コードが混在
- 拠点や担当者ごとに出力形式が異なる
- 複数ファイルに分かれている

という前提だったため、  
まず **確実に処理できる形に揃える前処理**を行いました。

- 複数の文字コードで順に読み込みを試行
- 正常に読めた時点で内部用の文字コードに統一
- フォルダ内のCSVを自動探索して1つに統合
- 自動生成ファイルやエラーファイルを再処理しない除外制御

拠点差や担当者差があっても、  
**設定変更なしで動かせること**を重視しています。

---

### 2. 伝票単位での登録を画面操作として再現

単純な「1行＝1登録」ではなく、  
実際の業務では **複数行で1伝票**となるため、

- CSV内の特定列を使って伝票の切り替わりを判定
- 同一伝票内は明細行として扱う
- 伝票が切り替わったタイミングで保存処理を実行

という流れを実装しました。

画面操作では、

- 入力中の行番号を画面要素から取得
- 行追加操作を人と同じ操作で再現
- 一時的に画面要素が取得できない場合は再試行・代替手段を使用

など、  
**画面仕様に強く依存する部分ほど慎重に実装**しています。

---

### 3. 誤登録を防ぐための安全装置

自動化で最も避けるべきなのは、  
誤ったデータを気づかないまま大量登録してしまうことです。

そのため、

- 保存前に画面上の差額合計を取得
- 差額がゼロでない場合は保存処理を行わない
- 該当データはエラーとしてCSVログに記録

という **必ず止まるチェックポイント**を設けました。

---

### 4. 途中停止を前提にした構成

処理件数が多いため、

- 途中で停止しても問題ない
- 再実行しても二重登録しない

ことを前提としています。

- 登録済みデータの識別キーを結果CSVに記録
- 起動時にそのキーを読み込み、処理済み分を自動スキップ

することで、  
長時間処理でも現場が安心して回せる構成にしています。

---

### 5. 初期セットアップの自動化

「自分がいない状況で実行される」前提に立ったとき、  
最もトラブルになりやすいのは **初期セットアップ**だと判断しました。

特にブラウザ操作に必要なドライバーは、
環境差や更新状況によって簡単に動かなくなります。

そのため、

- 起動時にドライバーの有無と実行可否を確認
- 不足している場合は自動で取得・配置
- 実行可能な状態を確認してから処理開始

という流れを実装し、  
**実行者が環境構築を意識せずに起動できる**構成としました。

---

### 6. 現場向けの進捗表示とログ

エンジニア不在の現場でも使えるよう、

- 常に表示される進捗ウィンドウ
- 処理件数・進捗率・残り時間の目安
- エラー内容を一覧で確認できるCSVログ

を用意しました。

「今どこまで終わったか」「何を直せばいいか」が  
**コードを見なくても分かること**を重視しています。

---

## 使用技術

- Python 3
- ブラウザ自動操作
- 標準GUIライブラリ
- CSV解析・正規表現
- 実行ファイル化による配布対応

※ 特定の製品名・社内構成が特定される情報は記載していません。

---

## 結果と評価

- 他拠点では手入力対応となった大量仕訳作業を、
  **自動化により短期間で処理**
- 開発者不在でも実行できる構成で、現場負担を軽減
- 制約や調整を踏まえた上で、
  最も現実的な方法を選択し、移行作業を完遂

---

## 想定外だった点

技術的なトラブルではありませんが、  
結果として本ツールは **他拠点への横展開までは行われませんでした**。

設計上は他拠点でも利用できる構成としていましたが、  
実際には運用判断や調整の都合により、  
各拠点で異なる対応が取られる結果となりました。

---

## この取り組みで意識したこと

- 技術的に正しいかより、現場で回るか
- 自分がいない前提での安全性・再現性
- 「できる」ではなく **「終わらせる」ための判断**
