# 画像認識＋OCR＋自動操作ツール（個人作業の自動化）

画面上の UI 要素や表示テキストを **画像認識・OCR で検出し**、  
その結果に基づいて **自動操作（入力）まで一気通貫で行う**、作業自動化ツールです。

目視確認 → 判断 → 同じ操作の繰り返し、という手作業を  
「画面キャプチャ → 領域切り出し → OCR → 判定 → 入力」の流れに置き換え、  
作業効率と再現性を高めました。

---

## 何を自動化したか（実装ベース）

- 対象ウィンドウを取得してスクリーンショットを撮影
- 画面内の固定 UI から **5枠分の情報を切り出し**
- 各枠を OCR で読み取り、条件文字列と照合
- 全枠一致なら終了、不一致なら **決められた入力シーケンスを再実行**

いわゆる  
「狙った結果が出るまで同じ操作を回す作業」を  
人の目と手の代わりにツールが実行する構成です。

---

## 主な機能

- ウィンドウ指定によるスクリーンショット取得
- UI 領域の切り出し（解像度依存しにくい比率指定）
- OCR 前処理（二値化・反転）による認識安定化
- OCR 結果の並び順補正による文章復元
- スロットごとの条件判定（部分一致）
- 最大回数・開始遅延・入力リセットを備えた安全設計

---

## 使用技術

- Python
- OpenCV
- NumPy
- Pillow
- OCR ライブラリ（CPU 実行）
- スクリーンショット取得
- 仮想ゲームパッド入力

---

## 実装の特徴（ソース確認ベース）

### 1. 「まず確認用ツールを作る」開発スタイル

本体実装に入る前に、  
以下のような **ミニマムな検証用スクリプトを用途別に作成**しています。

- クリックした座標と画面サイズ比率を即表示するツール
- UI 切り出し位置を保存して目視確認するデバッグ用スクリプト
- OCR 用の前処理結果をその場で確認する 2 値化調整ツール
- 切り出した各枠を個別に OCR テストする専用スクリプト

これにより、

- 座標は正しいか
- 比率指定でズレないか
- OCR が読める条件はどこか

を **実行しながら即確認できる状態**を作ってから  
本体ロジックを組み上げています。

---

### 2. 座標を固定値ではなく「比率」で管理

UI の切り出し座標はピクセル直指定ではなく、

- 画像幅・高さに対する比率
- 行ごとの top 比率＋共通の高さ比率

で管理しています。

座標確認ツールで  
「この位置は画面の何％か」を確認し、  
その値をそのまま切り出し処理に反映しています。

これにより、解像度やウィンドウサイズが変わっても  
切り出しが大きく崩れにくい構成になっています。

---

### 3. OCR を前提にした前処理と調整フロー

OCR は環境差でブレやすいため、

- グレースケール化
- しきい値による 2 値化
- 黒白反転
- BGR 3ch 変換

という前処理を行っています。

しきい値についても、  
スライダーで動かしながら結果を確認できる  
**専用の調整ツール**を作成し、  
最適な値を決めてから本体に反映しています。

---

### 4. OCR 結果をそのまま信じない設計

OCR の返却は単語単位で順序が崩れるため、

- 各単語の矩形座標を取得
- 上から下、左から右の順になるようソート
- content を連結して最終文字列を生成

という処理を挟んでいます。

また、判定は完全一致ではなく **部分一致**を採用し、  
OCR の揺れを許容しています。

---

### 5. 入力シーケンスは「確実さ」優先

自動操作は仮想コントローラー入力で行い、

- 押下と解放を明確に分ける
- 各操作の間に待機時間を入れる

ことで、  
画面遷移を取りこぼさない構成にしています。

UI を画像で追い続けるのではなく、  
「既知の手順を確実に回す」方針です。

---

### 6. 暴走しないための安全設計

- 開始前の待機時間
- 最大ループ回数の制限
- 終了時の入力リセット

を用意し、  
誤動作時に被害が広がらないようにしています。

---

## 成果・効果

- 目視確認＋手動操作を繰り返す作業を自動化
- 判断ブレや見落としを削減
- 条件が揃うまでの試行を機械に任せ、作業時間を大幅短縮
- 調整・修正がしやすいデバッグ導線を確保

---

## このツールで意識したこと

- いきなり本体を書かない
- まず「見える・確認できる」小さなツールを作る
- OCR や画像認識は失敗する前提で設計する
- 自動化は速さよりも確実さを優先する

実務の作業自動化を想定し、  
**調整しながら育てられる構成**を重視しています。
